---
title: "Team 3-1: Analyzing Billboard Songs"
output:
  pdf_document: default
  html_document: default
author: "Aimi, Sonya, Ethan, Luca"
---

## Introduction

“The Billboard Hot 100 is the music industry standard record chart in the United States for songs, published weekly by Billboard magazine. Chart rankings are based on sales (physical and digital), radio play, and online streaming in the United States.”

The data was found on TidyTuesday and is from Data.World with the original data points found on Billboard.com and Spotify. There are 2 sets of data. One is from the Billboard.com. The cases are songs from the certain week(s) in which they appeared on the Billboard 100 chart. It includes every weekly Hot 100 singles chart from Billboard.com. The other is from Spotify. The cases are songs with their audio features (such as genre, danceability) as the other variables. We combined these 2 dataset into one by joining with the common variables: song name and performer. For our final dataset, the cases are songs from the certain week(s) in which they appeared on the Billboard 100 chart along with the songs' audio features. 

From this dataset, we're interested in examining songs from 2000 to today. This gave us 114,319 datapoints. Since there are so many song attributes in the dataset, we decided to focus on attributes that are easily identifiable through hearing by the general population: genre, danceability, energy, speechiness, valence, and tempo. For more details about our variables, please refer to our ReadMe. Our main research question is: what factors influence a song's ranking?


```{r load-packages, message= F, echo= FALSE}
library(tidyverse) 
library(tidymodels)
library(stringr)
```


```{r load-in-data, message=FALSE, warning=FALSE, echo= FALSE}
billboard <- 
  readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-09-14/billboard.csv')
audio_features <-
  readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-09-14/audio_features.csv')
```


```{r creating-dataset, message=FALSE, warning=FALSE, echo= FALSE}
billboard2 <- billboard %>% 
  mutate(date = as.Date(week_id, format = "%m/%d/%Y", origin = "1958-08-02")) %>%
  mutate(month = format(date, "%m")) %>%
  mutate(year= format(date, "%Y"))

all_combined <- audio_features %>%
  right_join(billboard2, by= c("song", "performer"))

combined <- all_combined %>%
  filter(year > 1999) 
```


## Looking into Song Rankings

To start answering our research question, we first took a general look at how attributes influence song rankings. 

## Correlation Between Song Rankings and Song Attributes

<<<<<<< HEAD
To accomplish this, we created a visualization to see to the correlation between songs' weekly positions and song attributes. We first hypothesized that songs with higher speechiness and valence will be ranked higher, given the rising popularity of rap, and that other attributes would correlate less with songs' rankings. 
=======
To accomplish this, we created visualizations to see the correlation between songs' weekly positions and song attributes. We hypothesize that songs with higher speechiness and tempo will be ranked higher, given the rising popularity of rap, and that other attributes would correlate less with songs' rankings. 
>>>>>>> 16c1a67c8ea12db4cd1be8fdfddbc8fe07323058


```{r visualizing-factors, fig.height= 2, fig.width= 3, echo= FALSE, warning=FALSE}
par(mfrow = c(3,2))
combined %>%
  ggplot(mapping = aes(x = danceability, y = week_position)) +
  geom_hex() + 
  labs(title = "How Does Danceability affect the 
       Weekly Position of a Song?",
       Subtile = "1.A",
       x = "Danceability", y = "Weekly Position") +
  theme(plot.title = element_text(size = 8),  
        plot.subtitle = element_text(size = 6))

combined %>%
  ggplot(mapping = aes(x = valence, y = week_position)) +
  geom_hex() + 
  labs(title = "How Does Valence affect the 
       Weekly Position of a Song?",
       subtitle = "1.C",
       x = "Valence", y = "Weekly Position") +
  theme(plot.title = element_text(size = 8), 
        plot.subtitle = element_text(size = 6))

combined %>%
  ggplot(aes(x = tempo, y = week_position)) + 
  geom_hex() + 
  labs(title = "How Does Tempo affect the 
       Weekly Position of a Song?", 
       subtitle = "1.D",
       x = "Tempo", y = "Weekly Position") +
  theme(plot.title = element_text(size = 8), 
        plot.subtitle = element_text(size = 6))

combined %>%
  ggplot(mapping = aes(x = speechiness, y = week_position)) +
  geom_hex() + 
  labs(title = "How Does Speechiness affect the 
       Weekly Position of a Song?", 
       subtitle = "1.E",
       x = "Speechiness", y = "Weekly Position") +
  theme(plot.title = element_text(size = 8), 
        plot.subtitle = element_text(size = 6))
```

When examining the graphs, we know there will be an even distribution of data along the y-axis, since there is one #1 song, #100 song, and everything in between from each week. If there is an association between variables, though, there would be non-vertical patterns in the data. Danceability seems like it may be slightly curved to the right as y approaches 0, which could suggest that more danceable songs tend to rank higher, but the visual pattern isn't remarkable. Valence appears to have no pattern at all, whereas songs seem to for the most part have danceablilty in the 0.5 to 0.75 range, the valence chart has songs in all areas of the graph. Once again, this doesn't display a perceivable association. Tempo is similar, with two vertical-shaped light streaks suggesting that many songs, regardless of rank, have tempos around 100 and 120. Finally, speechiness seems to be a variable that is centered close to 0 regardless of rank, which again suggests no perceivable association.

At this point, it does not seem likely that song attributes are valuable predictors of song rank. However, there is a lot of data displayed here, so much so that the graphs have points in a majority of the hexbins available. This could make it harder for us as humans simply looking out a plot to observe a relationships between song position and audio variables that may be hiding in the data. To investigate this, our computational analytical techniques may be more useful.

## Testing Predictors

To further examine the relationship, we looked to see how well each song attribute predicted songs' weekly positions. Given the results from above, we hypothesize that danceability would be one of the highest predictors, since its visualization is one of the only visualizations to show a difference between differently ranked songs. We created linear regression models for each attribute and also a linear model with all the attributes as the explanatory variables. We then found the r-squared value to see how well the explanatory variable(s) predicted songs' weekly positions. 

Danceability Linear Model and its R-Squared Value: 
```{r danceability linear-model, echo= FALSE, warning=FALSE}
danceability_model <- linear_reg() %>%
  set_engine("lm") %>%
  fit(week_position ~ danceability, data = combined)
tidy(danceability_model)

glance(danceability_model)$r.squared
```
Energy Linear Model and its R-Squared Value: 
```{r Energy Linear Model, echo= FALSE, warning=FALSE}
energy_model <- linear_reg() %>%
  set_engine("lm") %>%
  fit(week_position ~ energy, data = combined)
tidy(energy_model)

glance(energy_model)$r.squared
```
Speechiness Linear Model and its R-Squared Value: 
```{r Speechiness Linear Model, echo= FALSE, warning=FALSE}
speechiness_model <- linear_reg() %>%
  set_engine("lm") %>%
  fit(week_position ~ speechiness, data = combined)
tidy(speechiness_model)

glance(speechiness_model)$r.squared
```
Valence Linear Model and its R-Squared Value: 
```{r Valence Linear Model, echo= FALSE, warning=FALSE}
valence_model <- linear_reg() %>%
  set_engine("lm") %>%
  fit(week_position ~ valence, data = combined)
tidy(valence_model)

glance(valence_model)$r.squared
```
Tempo Linear Model and its R-Squared Value: 
```{r Tempo Linear Model, echo= FALSE, warning=FALSE}
tempo_model <- linear_reg() %>%
  set_engine("lm") %>%
  fit(week_position ~ tempo, data = combined)
tidy(tempo_model)

glance(tempo_model)$r.squared
```
Overall Linear Model and its R-Squared Value: 
```{r Overall Linear Model, echo= FALSE, warning=FALSE}
overall_model <- linear_reg() %>%
  set_engine("lm") %>%
  fit(week_position ~ danceability + energy + speechiness + valence + tempo, data = combined)
tidy(overall_model)

glance(overall_model)$r.squared
```

<<<<<<< HEAD
=======

In analyzing which predictor correlated the strongest with the weekly position of the song we found that due to the 
>>>>>>> 98282979942a9c67f7f0573d21431c5cf1e9922d

## Looking into #1 Billboard Songs

Arguably, many artists' want to have a #1 Billboard song. So, to further investigate what factors play a role in songs' rankings, we looked at factors that influence #1 Billboard songs. 

## Seasons

Seasons can influence what song attributes are preferred. For example, winter has many holidays, so that we hypothesize that that happier songs with medium tempos will be #1 Billboard songs. We separated the dataset by seasons and looked at the distribution of attributes' values by creating boxplots. We defined fall as from September to November, winter as from December to February, spring as March to May, and summer as June to August. 

```{r group-dataset-by-season, echo= FALSE, warning=FALSE}
combined$month <- as.numeric(combined$month)
season_data <- combined %>%
  filter(week_position == 1) %>%
  mutate(season = case_when(month == (9) ~ "fall",
                            month == (10) ~ "fall",
                            month == (11) ~ "fall",
                            month == (12) ~ "winter",
                            month == (1) ~ "winter",
                            month == (2) ~ "winter",
                            month == (3) ~ "spring",
                            month == (4) ~ "spring",
                            month == (5) ~ "spring",
                            TRUE ~ "summer")) 

```

```{r season-visualization, fig.height= 2, fig.width= 5, echo= FALSE, warning=FALSE}
ggplot(data = season_data, 
       mapping = aes(x = season, y = tempo)) +
  geom_boxplot() + coord_flip() +
  labs(title = "How does tempo relate to #1 songs seasonally?", 
       x = "Season", y = "Tempo")

```

```{r season-energy-viz, fig.height= 2, fig.width= 5, echo= FALSE, warning=FALSE}
ggplot(data = season_data, 
       mapping = aes(x = season, y = energy)) +
  geom_boxplot() + coord_flip() +
  labs(title = "How does energy relate to #1 songs seasonally?", 
       x = "Season", y = "Energy")
```

```{r season-valence-viz, fig.height= 2, fig.width= 5, echo= FALSE, warning=FALSE}
ggplot(data = season_data, 
       mapping = aes(x = season, y = valence)) +
  geom_boxplot() + coord_flip() +
  labs(title = "How does valence relate to #1 songs seasonally?", 
       x = "Season", y = "Valence")
```

```{r season-energy-dance, fig.height= 2, fig.width= 5, echo= FALSE, warning=FALSE}
ggplot(data = season_data, 
       mapping = aes(x = season, y = danceability)) +
  geom_boxplot() + coord_flip() +
  labs(title = "How does danceability relate to #1 songs seasonally?", 
       x = "Season", y = "Danceability")
```

```{r season-energy-speechiness, fig.height= 2, fig.width= 5, echo= FALSE, warning=FALSE}
ggplot(data = season_data, 
       mapping = aes(x = season, y = speechiness)) +
  geom_boxplot() + coord_flip() +
  labs(title = "How does speechiness relate to #1 songs seasonally?", 
       x = "Season", y = "Speechiness")
```


## Testing Pop Genre
To examine the correlation between genre and Billboard rankings, we created a null and alternative hypothees to test with simulation-based methods. Since the labels "pop genre" and "popular genre" tend to be interchangeable, we predict that the majority of songs that are #1 on the Billboard are of the pop genre. 

Null Hypothesis: 50% of the #1 Billboard songs are of the pop genre. 
Alternative Hypothesis: Over 50% of the #1 Billboard songs are of the pop genre. 

$$H_0: p_{pop} = 0.5 \text{v.s.} H_a: p_{pop} > 0.5$$

To test our hypotheses, we first created a dataset of just the #1 Billboard songs. We then checked to see if the word "pop" appears in the Spotify genre column. With our dataset set up, we constructed a null distribution. We set the seed to make this reproducible. After constructing our null distribution, we created a visualization of it (Figure 3) and also calculated the p-value. Since our alternative hypothesis is greater than 0.5, we did not do a two-sided p-value; we only looked at it from the greater direction. 

```{r dataset-for-top-song, echo= FALSE, warning=FALSE}
combined_1 <- combined %>%
  filter(week_position == 1)
```

```{r is-it-pop, echo= FALSE, warning=FALSE}
combined_1 <- combined_1 %>%
  filter(spotify_genre != "[]") %>%
  mutate(is_pop= ifelse(str_detect(spotify_genre, "pop")== TRUE, "Yes", "No"))
```


```{r null-distribution, echo= FALSE, warning=FALSE}
set.seed(1)
null_dist <- combined_1 %>%
  specify(response= is_pop, success = "Yes") %>%
  hypothesize(null= "point", p= 0.5) %>%
  generate(reps= 10000, type= "draw") %>%
  calculate(stat= "prop")

p_hat <- combined_1 %>%
  count(is_pop) %>%
  mutate(prob= n/ sum(n)) %>%
  filter(is_pop== "Yes") %>%
  pull()
```

```{r visualizing-null-p-value, fig.height= 2, fig.width= 5, echo= FALSE, warning=FALSE}
visualize(null_dist) + 
  shade_p_value(obs_stat= p_hat, direction= "greater") + 
  labs(title= "Simulation-Based Null Distribution", 
       subtitle= "Figure 3", 
       x= "Proportion", 
       y= "Count")

p_value <- null_dist %>%
  get_p_value(obs_stat= p_hat, direction= "greater") %>%
  pull()

p_value
```
Using the typical significance level of 0.05, we reject the null hypothesis. Given that the p-value is 0, there is strong evidence that the majority of #1 Billboard songs are of the pop genre. 


To verify our conclusion from above, we also decided to perform a confidence interval Test. We decided to do a 95% confidence interval test since that seems to be the typical confidence interval. To perform this test, we first created a bootstrap distribution, then found the range of the middle 95% of the bootstrap distribution. 

```{r create-bootstrap, echo= FALSE, warning=FALSE}
set.seed(2)
boot_dist <- combined_1 %>%
  specify(response= is_pop, success= "Yes") %>%
  generate(reps= 10000, type= "bootstrap") %>%
  calculate(stat= "prop") 

```

```{r CI-test, echo= FALSE, warning=FALSE}
CI <- boot_dist %>%
  summarize(lower= quantile(stat, 0.025), 
            upper= quantile(stat, 0.975))

CI
```
We are 95% confident that the proportion of #1 Billboard songs that are of the pop genre is between 0.89 and 0.92. Since this interval does not have 0.5 between it, we reject our null hypothesis, further providing evidence that the majority of #1 Billboard songs are of the pop genre. 



## Conclusion

Need to add: This will require a summary of what you have learned about your research question along with statistical arguments supporting your conclusions. You should critique your own methods and provide suggestions for improving your analysis and future work. Issues pertaining to the reliability and validity of your data and the appropriateness of the statistical analyses should also be discussed. Also include a brief paragraph on what you would do differently if you were able to start over with the project.


- scope of the data => made it hard to fit our linear models to it
- how to predict song's data on numbers
- catchiness variable
- up to performers themselves (a lot more factors than we chose to focus on/what the data had)
